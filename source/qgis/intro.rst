.. sectionauthor:: Артём Светлов <artem.svetlov@nextgis.ru>

.. _ngcourse_qgis_intro:

Введение
========

.. note::
   Этот раздел сейчас пишется. БОЛЬШИМИ БУКВАМИ отмечены заметки TODO
   
Настоящий курс предназначен для начинающих пользователей и охватывает различные
аспекты работы в NextGIS QGIS с начала

Обзор
================================

Так же, как мы используем текстовый процессор для создания документов и работы со словами на компьютере, мы используем ГИС-приложение для работы с пространственной информацией. ГИС это сокращение от Географическая Информационная Система.

ГИС состоит из:

* Цифровые данные — географическая информация, которую вы просматриваете и анализируетер используя компьютер и программное обеспечение.

* Аппаратное обеспечение — компьютеры, хранящие, отображающие и обрабатывающие данные.

* Программное обеспечение — программы, запускаемые на компьютерах и позволяющие работать с цифровыми данными. Программы, являющие частями ГИС называют ГИС-приложениями.

ГИС-приложения позволяют открывать электронные карты на компьютере, создавать новые пространственные объекты и добавлять их на карты, изготавливать печатные карты и выполнять пространственный анализ.


As information becomes increasingly spatially aware, there is no shortage of tools able to fulfill some or all commonly used GIS functions. Why should anyone be using QGIS over some other GIS software package?

Here are only some of the reasons:

    It’s free, as in lunch. Installing and using the QGIS program costs you a grand total of zero money. No initial fee, no recurring fee, nothing.
    It’s free, as in liberty. If you need extra functionality in QGIS, you can do more than just hope it will be included in the next release. You can sponsor the development of a feature, or add it yourself if you are familiar with programming.
    It’s constantly developing. Because anyone can add new features and improve on existing ones, QGIS never stagnates. The development of a new tool can happen as quickly as you need it to. ВОТ Я ЭТО НЕФТЯННИКАМ СКАЗАЛ, А ОНИ СРАЗУ - ЭТО НЕ ТРУ, ЗНАЧИТ ОНО НЕДОДЕЛАНО. НУ ВОТ ЧТО ТАКИМ ОТВЕТИТЬ?
    Extensive help and documentation is available. If you’re stuck with anything, you can turn to the extensive documentation, your fellow QGIS users, or even the developers.
    Cross-platform. QGIS can be installed on MacOS, Windows and Linux.

Now that you know why you want to use QGIS, we can show you how. The first lesson will guide you in creating your first QGIS map.
https://docs.qgis.org/2.14/en/docs/training_manual/introduction/intro.html cc-by-sa

мы делаем кугис
это российский софт
ВЗЯТЬ ТЕКСТ ИЗ МОЕЙ ПРЕЗЕНТАЦИИ

Начальные настройки qgis
------------------------------------------

1. Проверяем включение плагина quickmapservices, nextgis connect
2. Проверяем включение мультипоточной обрисовки

Quickstart
---------------------

1. Открываем сохранёный проект из выгрузок.

Слои
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Их можно включать-выключать, и переносить вверх-вниз. При работе в десктопной ГИС человек всё время их включает-выключает и перетаскивает, в этом и заключается работа.

In the Layers list, you can see a list, at any time, of all the layers available to you.

Expanding collapsed items (by clicking the arrow or plus symbol beside them) will provide you with more information on the layer’s current appearance.

Right-clicking on a layer will give you a menu with lots of extra options. You will be using some of them before long, so take a look around!

Карта
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Что про неё можно сказать? Ну это надо взять из документации какой-нибудь умной. Ещё тут надо проверить включено ли мультипоточный редеринг, хотя это не к месту, и вообще не понятно что тут писать.

панель состояния.
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

она будет рассмотрена ниже

Операции на файловом уровне
------------------------------------------

Геоданные бывают векторные и растровые. Векторные данные обычно хранятся как электронная 
таблица, где у каждой записи есть своя геометрия - то есть фигура, заданная координатами 
точек. Растровые данные обычно сохраняются как картинка, в которой указано, на какое 
место земного шара она ложится.

Существует множество форматов хранения геоданных и протоколов их передачи по сети. 
Они могут представлять собой файлы или находиться в базах данных. Преобразованием 
форматов занимаются утилиты :program:`GDAL` (растровые) и :program:`OGR` (векторные). 
Благодаря этим утилитам :program:`NextGIS QGIS` может читать и записывать разные 
форматы данных без сильных различий для пользователя. Разумеется, обычно используются 
только самые общеупотребительные форматы.

.. note::
   QGIS использует библиотеку OGR для чтения и записи векторных данных (работа с векторными
   данными GRASS и данными PostgreSQL реализована через отдельные модули поставщиков 
   данных), включая :term:`ESRI Shapefile` файлы, файлы MapInfo и Microstation, пространственные 
   базы :term:`PostGIS`, SpatiaLite, Oracle и многие другие. Кроме того, векторные данные могут 
   быть загруженны напрямую из архивов zip или gzip. С полным списком форматов векторных 
   данных можно ознакомиться по адресу: http://www.gdal.org/ogr/ogr_formats.html .

Понятие Слой будет часто встречаться в инструкции. Слой - это геоданные с определенным
составом и оформлением. Карта состоит из одного или нескольких слоев.

.. note:: Для открытия файлов векторных геоданных вам потребуется знать: место, где лежат файлы на диске, их кодировку.

Для добавления слоя выполните: ``Слой ‣ Добавить слой ‣ Добавить векторный слой`` или 
``Слой ‣ Добавить слой ‣ Добавить растровый слой`` соответственно.

Задание: открыть шейп из файла и сохранить в разные форматы
--------------------------------------------------------------

Учебные данные:
1. Выгрузка из Openstreetmap в Shapefile


GEOPACKAGE
^^^^^^^^^^^^^^^^^^^^

Сохраняем в gеоpackage, это формат по умолчанию

ESRI SHAPEFILE
^^^^^^^^^^^^^^^^^^^^^^

Сохраняем в шейп. Сохранять нужно в epsg:4326 и UTF-8

Показ содержимого шейпфайла на жестком диске в totalcommander

При открытии ESRI Shapefile в этом диалоге нужно выбирать файл с расширением .shp.

Также вам необходимо знать кодировку файлов: 

* Если кодировка файлов - UTF-8 и вы работаете в Windows, то при открытии векторных 
  файлов в поле ``Кодировка`` вместо System рекомендуется выбирать UTF-8.
* Если кодировка файлов - Windows-1251 и вы работаете в Windows, то при открытии 
  векторных файлов кодировку менять нет необходимости.
* Если кодировка файлов - UTF-8 и вы работаете в Linux, то при открытии векторных 
  файлов кодировку менять нет необходимости.
* Если кодировка файлов - Windows-1251 и вы работаете в Linux, то при открытии векторных 
  файлов в поле ``Кодировка`` вместо System выберите Windows-1251.

.. note::
   На текущий момент принято, что все данные сохраняются в кодировке UTF-8. При 
   работе на ОС Windows при открытии и сохранении векторных данных нужно явно указывать 
   кодировку UTF-8. По умолчанию она может быть System - это значит Windows-1251. Если вы 
   открыли файл в неправильной кодировке, то русские буквы там будут нечитаемыми. 
   В этом случае нужно в свойствах слоя выставить кодировку UTF-8. Но лучше сразу 
   выставлять её при открытии файла, чтобы не забыть.

.. note::
   Если в таблице атрибутов вы увидите нечитаемые символы, переключите кодировку 
   между UTF-8 и Windows-1251 в свойствах слоя.
   

GeoJSON
^^^^^^^^^^^^^^^^^^^^^^^

Сохраняем в gеоjson.

Открываем GeoJSON.

Открываем GeoJSON в блокноте.

Энтерпрайзные форматы
^^^^^^^^^^^^^^^^^^^^^^^^^

Связь с MapInfo, Arc*, Oracle, CAD-системами

Добавление базовых карт из Интернета
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Для добавление базовой карты (картографической подложки, картподложки) следует воспользоватся плагином QuickMapServices. 

Картографическая подложка часто выступает в качестве первого слоя, добавляемого для 
работы в проект. Подложка часто представлена в виде различных интернет-сервисов: 
TMS, WMS, WMTS, ESRI ArcGIS Service или просто в виде тайлов XYZ.

Но запомнить адреса Интернет-сервисов сложно, а процесс их ввода каждый раз при смене 
рабочего места отнимает достаточно много времени. Поэтому для оптимизации работы был разработан 
плагин QuickMapServices — расширение, которое 
позволяет быстро и удобно работать с базовыми картами, получаемыми из 
различных интернет-сервисов в проект QGIS. 

В QuickMapServices есть два хранилища для подложек: базовое и дополнительное. Подложки 
из базового набора устанавливаются и включаются вместе с модулем расширения.
Описание модуля находится в главе :ref:`_QuickMapServices`.

Задание: найти в QMS полезные базовые слои
----------------------------------------------------------

Учебных данных не нужно.

В QMS есть много разных слоёв. В удобных программах есть подложки, и это хорошо. 
Все используют OSM, там много серверов которые поддерживают разные ботаники патлатые. Они отличаются оформлением, скоростью обновления, тем что некоторые упавши, и некоторые тормозят. Это openstreetmap mapnik, openstreetmap.de, openstreetmap.fr

Можно искать по охвату всё.


Панель состояния
================================

Задание: открыть выгрузку из OSM в Shapefile
-------------------------------------------------

1. В окне показываются координаты в той системе координат, что пишется в углу. Практического смысла от них особо нет, применяются только в одном случае - посмотреть в чём измеряются координаты в текущей системе координат - градусах, метрах, или пикселах.
2. Масштаб. Можно вводить с клавиатуры, можно выбирать из списка. Список координат можно редактировать в настройках. Так же можно точно подгонять масштаб с клавишей Ctrl
3. Кнопка замок - меняет алгоритм масштабирования. У людей как - когда меняешь масштаб, размеры букв остаются те же. А теперь когда меняешь масштаб, буквы тоже будут мелкими. Другими словами - меняется разрешение. Там где от масштаба зависит отрисовка - оно остаётся таким же, а меняется охват.
4. Поворот карты. Слои поворачиваются, а подписи остаются горизонтальными. Потом ту же операцию можно сделать в при создании компоновки карты.
5. Галочка Render - если слоёв много, то когда всё тормозит, её можно выключить, поотключать все лишние слои, и включить обратно.
6. Кнопка в углу показывает систему координат, в которую преобразовывается всё на экране. Если преобразование координат включено, то пишется OTF. Как правило слои бывают в разных СК, и преобразование координат включено, что бы на экране всё рисовалось красиво.
7. Включаем перепроецирование в 4326 - всё сплющенное, в 32637 - всё нормально, но растры изогнутые. Включаем 3857 и живём с этим дальше.


Делаем учебный проект
===========================

Учебные материалы: подготовленные данные - 5 векторных слоёв типа выгрузки из osm, без оформления

1. Найти на диске учебные данные
2. Добавьте их в QGIS
3. Сохраните их в свой рабочий каталог в подходящем формате
4. Настройте порядок отображения слоёв
5. Сохраните проект с осмысленным именем файла

Таблица атрибутов
================================

Задание: открыть таблицу атрибутов слоя населённые пункты
---------------------------------------------------------------

1. Открываем таблицу атрибутов какого-нибудь слоя выгрузок.
2. Установки - параметры - Источники данных - Таблица атрибутов - Открывать таблицу во встроенном окне

У векторных слоёв имеются атрибуты, которые описывают свойства объектов слоя. Их используют для настройки отображения данных. Атрибуты векторных объектов хранятся в таблице.

1. Сортируем
2. Выделяем

Что делать если кракозябры 
-----------------------------

Сменить кодировку с CP1251 на UTF-8, переоткрыть таблицу


Так же можно легко открывать растровые слои
============================================

Задание: открыть космоснимок из файла
----------------------------------------------

Учебные данные: Landsat на Ярославскую область


1. Открываем космоснимок 

Подробнее расбота с растровыми слоями будет расспотрена в последний день

Подкладываем мапник qms. Сам плагин уже установлен автоматом. Рассказываем процесс подключения модулей. Процесс обновления стилей в qgis.
    
Импорт из Excel.
================================

В реальной жизни вам часто будут встречаться данные из внешних систем, которые поставляются в электронных таблицах.





Добавление слоёв CSV
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Вам необходимо знать систему координат, в которой записаны координаты.

Для добавления слоя в формате на карту нажмите ``Слой ‣ Добавить слой ‣ Добавить слой CSV``. 
Откроется окно "Создать слой из текстового файла".

.. figure:: _static/add_layer_table_wms.png
   :align: center
   :width: 16cm

   Окно открытия CSV. 1 - выбор разделителя. 2 - выбор полей координат.  

В окне необходимо выбрать разделитель колонок текстового файла так, чтобы столбцы были правильно разделены.

.. note::
   Если колонки разделяются запятой, то выберите разделитель "Запятая". Если колонки разделяются точкой с запятой, то выберите разделитель "Точка с запятой". 

В полях ``X-координата`` и ``Y-координата`` необходимо указать, из каких полей будут браться координаты.

После нажатия кнопки "OK" вам нужно будет указать систему координат, в которой записаны координаты. 

После открытия координат - подложите Mapnik, и проверьте, в правильное ли место попали координаты. 
Если они попали в другое место, скорее всего перепутаны широта и долгота. Нужно импортировать слой заново,
и задать поля ``X-координата`` и ``Y-координата`` по-другому.

Формат CSV слабо стандартизирован и может иметь различные написания:

* Десятичный формат (десятичные градусы): записи вида 37.677,55.677. Это предпочтительный формат, он требует минимум ручных настроек. Скорее всего система координат этого слоя - EPSG:4326.

.. code-block:: csv
   :caption: Пример CSV-файла с координатами в десятичном формате

   X,Y,name,routes
   37.498976596578487,55.818108414611515,"""Метро \""Войковская\""""","43к,57"
   37.511937669160822,55.737294006553164,"""Метро «Парк Победы»""",7
   37.51358652686482,55.678694577011598,"""улица Кравченко""",34к
   37.513861321510234,55.80268809185204,"""Метро \""Сокол\""""","19,59,61"
   37.516176549491988,55.884889270968166,"""Базовская улица""",56

* Координаты в метрах: записи вида 444556, 555544. Это похоже на местную систему координат. Технически вы можете открыть её, но должны знать для неё параметры системы координат. 

.. code-block:: csv
   :caption: Пример CSV-файла с координатами в МСК

   X,Y
   416386,75285
   416735,75318
   416943,75224
   416417,75119
   418105,75274

* WKT: записи вида "POLYGON((11 21,31 41, 21 11))".

.. code-block:: csv
   :caption: Пример CSV-файла с координатами в WKT

   WKT,routes_ref,
   "LINESTRING (4191295.66 7512782.48,4191300.86 7512785.6,4191307.97 7512786.73,4191315.91 7512785.11)",24>
   "LINESTRING (4191561.23 7512690.26,4191549.12 7512685.85)",24<
   "LINESTRING (4191231.01 7512625.63,4191286.55 7512761.42,4191290.63 7512771.38,4191295.66 7512782.48)",24>
   "LINESTRING (4191790.37 7512685.37,4191929.86 7512690.42,4191977.72 7512692.14)",24
   "LINESTRING (4191703.18 7512684.54,4191649.66 7512688.46,4191587.57 7512688.34,4191561.23 7512690.26)",24<
   "LINESTRING (4192733.59 7512710.92,4192749.47 7512710.92,4192829.78 7512710.15,4192946.34 7512709.49,4193040.41 7512708.56,4193196.01 7512704.19,4193205.31 7512703.52,4193325.58 7512699.48)",24
   "LINESTRING (4193367.88 7512698.49,4193391.35 7512698.37)",24


* HMS (градусы-минуты-секунды): записи вида 46°01’24 СШ, 11°13’47 ВД. Скорее всего этот слой откроется как EPSG:4326, но вам придётся самому изменить формат координат в исходном csv-файле.

Допустимые форматы записи координат с градусами:

.. code-block:: csv
   :caption: Пример CSV-файла с координатами в HMS

   LATITUDINE;LONGITUDINE
   46°01’24,7”;11°13’47,5”
   45°42’07,5”;10°55’11,3”
   46°01’37,6”;11°06’41,7”
   46°15’03,7”;11°11’00,1”


.. code-block:: csv
   :caption: Пример CSV-файла с координатами в HMS с пробелами

   n,y,x
   1, 78 16 42 N, 50 29 38 E
   2, 79 28 52 N, 53 00 00 E
   3, 79 28 52 N, 61 33 03 E


Задание
^^^^^^^^^^^^^^^^^^^^^^^^

Учебные данные:
1. Таблица odf/xls: название субъекта РФ, количество населения, количество фирм из wikidata, относительное количество фирм.

Получено с query.wikidata.com

SELECT
	?state ?stateLabel
	?companies
	?population
	(?companies/?population*1000000 AS ?companiesPerM)
WHERE
{
	{ SELECT ?state (count(*) as ?companies) WHERE {
		{SELECT DISTINCT ?company ?state WHERE {
			?state wdt:P31/wdt:P279* wd:Q43263 .
			?company wdt:P31/wdt:P279* wd:Q4830453 .
			?company wdt:P159/wdt:P131* ?state .
			FILTER NOT EXISTS{ ?company wdt:P576 ?date } # don't count dissolved companies
		} }
	} GROUP BY ?state  }
    ?state wdt:P1082 ?population
	SERVICE wikibase:label { bd:serviceParam wikibase:language "ru" }
}
ORDER BY DESC(?companiesPerM)


1. Взять из учебных данных odf
2. В Excel/Calc открыть электронную таблицу, сохранить как csv - текст с разделителями. UTF-8, разделитель - любой.
3. QGIS, слой --> Добавить слой из файла с разделителями --> без геометрии
4. добавить из QMS Regions of Russia set 2
5. Свойства слоя с геометрией - joins. Выбрать для связи поля с названиями.
6. Некоторые записи не привяжутся, потому что жизнь - борьба.


    Открываем Excel, придумываем таблицу с широтой в градусах.
    Пишем формулу перевода из градусов в DMS. Пример формата: 46°01’24,7”;11°13’47,5”
    
    
    


Импорт из wms
================================

It's an OGC standard for serving up map images over HTTP. Работает он так: вам нужно знать адрес сервера. Вы вводите его в программу. Программа отправляет по адресу HTTP-запрос с магическим словом GetCapabiities, и получает с сервера список названий слоёв. Затем, при каждом перемещении карты, клиент отправляет на сервер запрос с указанием охвата и перечислением выбранных слоёв, а в ответ получает картинку в png или jpeg.

Задание
^^^^^^^^^^^^^^^^^^^^^^^^

Найти адрес wms кадастра, и подложить в QGIS

0. Подложить подложку OSM
1. Найти в интернете публичную кадастровую карту Росреестра.
2. Найти wms Росреестра. это http://pkk5.rosreestr.ru/arcgis/services/Cadastre/CadastreWMS/MapServer/WMSServer
3. QGIS Слой --> Добавить слой WMS --> Создать подключение. Вставить URL, получить список, выбрать в нём все слои
4. Переместить карту на Москву, должно нарисоваться кадастровое деление.
5. Если не работает, то это проблемы на сервере ПКК



Выделение объектов
===============================

Выделять объекты можно мышью.

Выделять объекты можно выражением.
Можно так же выделять объекты выражением только среди тех, что уже выделены.

Задание Открыть слой water-polygon.shp из выгрузок, выбрать только немаленькие озёра, сохранить в новый слой
----------------------------------------------------------------------------------------------------------------

Например, мы можем выбрать водные объекты с площадью выше заданной, и удалить их с экрана.
Можно выбрать водные объекты с длинным названием.

Задание: выбрать только озёра с длинным названием
----------------------------------------------------------------------------------------------------------------


Оцифровка
================================

Создание новых слоёв
-----------------------------

Есть 2 способа создания новых слоев:

1. ``Слой ‣ Создать слой ‣ Создать Shape-файл``. Следует задать 
   тип геометрии и набор атрибутов, указать путь сохранения файла. Слой добавляется, 
   а затем добавляете туда геометрию.
2. ``Слой ‣ Создать слой ‣ Создать временный слой``. Задать тип 
   геометрии, слой добавляется, затем добавляете туда геометрию и атрибуты. Затем 
   сохраняете его как Shape-файл или в другом необходимом вам формате.

.. note::
   В ESRI Shapefile и во временный слой можно добавлять и удалять атрибуты и после создания.

.. note::
   **Ограничения формата ESRI Shapefile**

   Имя атрибута должно быть написано латинскими буквами, но не более 12 символов. 
   Текстовое поле не может хранить данные длиннее 255 символов. 

.. _attributes_types:

У атрибутов могут быть разные типы данных: 

* строковый, 
* целочисленный, 
* дробный, 
* дата. 

Разные форматы файлов геоданных поддерживают разный состав типов атрибутов, но большинство поддерживает вышеперечисленные.
При добавлении атрибута нужно указать его тип и размер поля. 
При добавлении целочисленного атрибута нужно указать максимальное количество цифр в числе.
При добавлении десятичного числа нужно в поле длина указать общее число цифр в числе, 
в поле точность - количество цифр после запятой. Например, для хранения чисел формата 123,45 нужно указывать 5,3. 
Для 123456,7890 - 10,4.

.. figure:: _static/add_attribute_real.png
   :name: add_attribute_real
   :align: center
   :width: 16cm
   
   
   
Редактирование геометрий так же может называться оцифровкой. Все возможности редактирования 
векторных слоев разделены между панелями:

1. Панель инструментов "Оцифровка". 
2. Панель инструментов "Дополнительные функции оцифровки".

Для рисования включите панель инструментов "Оцифровка". См. подраздел :ref:`ngq_label_toolbars` про включение панелей.

.. figure:: _static/drawing_tools.png
   :name: ngqgis_drawing_tools
   :align: center
   :width: 10cm
 
   Панель инструментов "Оцифровка".   
 
.. todo::
   Поставить гиперссылку на раздел про включение панели.


По умолчанию, NextGIS QGIS подгружает слои, делая их доступными только для чтения. 
Это защита от непреднамеренного редактирования слоя, что случается, например, при 
неловком движении манипулятором мышь. Любой слой можно переключить в режим редактирования 
(если источник данных поддерживает запись, и есть разрешение на запись).
При выходе из режима редактирования правки сохраняются в файл слоя или в базу данных. 
Для начала редактирования выделите слой в списке слоёв и нажмите кнопку с карандашом на 
панели редактирования. Любое редактирование начинается с выбора функции "Режим редактирования". 

Для того, чтобы начать или закончить редактирование также можно использовать кнопку 
"Режим редактирования" на панели инструментов "Оцифровка". После того, как слой стал 
доступным для редактирования, над каждой вершиной появятся специальные маркеры и 
станут доступными к использованию кнопки с дополнительными функциями из панели инструментов.

.. note::
   **Регулярное сохранение**
   
   Не забывайте нажимать Сохранить изменения регулярно. Это позволит 
   не только сохранить последние изменения, но и удостовериться, что источники 
   данных могут принять все сделанные изменения.

Добавление объектов
^^^^^^^^^^^^^^^^^^^^^^^^^^^^
 
Для добавления объектов можно использовать кнопки на панели инструментов: 

* Создать точку, 
* Создать линию, 
* Создать полигон, 

чтобы переключить NextGIS QGIS в режим редактирования.

Для каждого объекта сначала идет оцифровка формы, а затем добавляются атрибуты. 
Чтобы начать оцифровку и создать первую точку нового объекта, надо нажать левой 
кнопкой мыши в области карты.

Для продолжения линий и полигонов надо продолжать нажимать на левую кнопку мыши 
для создания каждого дополнительного узла. Чтобы закончить редактирование объекта, 
щелкните правой кнопки мыши в любом месте карты, что подтвердит окончание
редактирования данного объекта. При этом, появится окно атрибутов для ввода 
информации для нового объекта. Во вкладке "Оцифровка" из меню ``Установки ‣ Параметры`` можно 
также активировать функцию "Не показывать всплывающее окно ввода атрибутов для каждого 
создаваемого объекта Использовать последние введённые значения".

С помощью опции ``Переместить объект`` на панели инструментов можно 
двигать созданные объекты.

**Типы значений атрибутов**

При редактировании :term:`ESRI Shapefile` типы атрибутов проверяются во время ввода. Поэтому 
невозможно ввести числовое значение в текстовое поле диалога "Атрибуты" или наоборот. 
Если это сделать все же необходимо, то следует отредактировать атрибуты на следующем 
шаге в диалоге "Таблица атрибутов".

Как для слоев данных :term:`PostGIS`, так и для слоев, состоящих из ESRI Shapefile, 
``Редактирование узлов`` предоставляет возможности изменения узлов объектов, 
аналогичные имеющимся в программах :abbr:`CAD (Computer-Aided Design)`. 
Можно выделить сразу множество вершин и 
перемещать, добавлять или удалять их все вместе. Инструмент редактирования узлов 
работает с включенной функцией перепроецирования "на лету", а также поддерживает 
топологическое редактирование объектов. Этот инструмент, в отличие от остальных 
инструментов NextGIS QGIS, довольно "настойчивый": так, когда некоторая операция 
выполнена, инструмент продолжает оставаться активным, а объект выделенным. Если 
инструмент редактирования узлов не может обнаружить объекты, на дисплей выдается 
предупреждение.

.. note::
   Если включено перепроецирование "на лету", и система координат карты отличается от
   системы координат слоя, то функции прилипания могут работать неккоректно из-за отличия
   в величине "близости" для различных систем координат. 

Важно правильно установить ``Установки ‣ Параметры ‣ Оцифровка ‣ Радиус поиска selectnumber``, 
значение должно быть больше нуля. В противном случае NextGIS QGIS не распознает редактируемую вершину.

**Маркеры вершин**

Данная версия NextGIS QGIS поддерживает три типа маркировки вершин:

1. Полупрозрачный круг. 
2. Перекрестие. 
3. Без маркера. 

Чтобы изменить стиль маркировки, выберите "Параметры" из меню "Установки" 
и на вкладке "Оцифровка" и далее выберите подходящий тип маркировки вершины.

**Основные операции**

Включите инструмент "Редактирование узлов" и выделите объект простым 
нажатием на него. На месте каждой вершины этого объекта появятся красные рамки.

**Выделение вершин**

Выделение узла происходит простым нажатием по нему кнопкой мыши, при этом цвет рамки 
изменится на синий. Чтобы выделить несколько узлов одновременно, надо удерживать 
клавишу ``Shift``. Нажатие на ``Ctrl`` используется для инвертирования выделения узлов 
(выделенные узлы становятся невыделенными и наоборот). Также несколько узлов одновременно 
можно выделить, если нажать кнопкой мыши где-нибудь в стороне от объекта и очертить 
прямоугольную область вокруг интересующего множества вершин. Или просто нажать на 
отрезок линии и оба смежных узла будут выделены.

**Добавление узлов**

Добавить узлы также просто. Двойной щелчок мыши рядом с отрезком линии добавит 
новую вершину рядом с положением курсора. 

.. note:: 
   Обратите внимание, что вершина появится 
   на ребре объекта, а не точно в месте курсора, но при необходимости ее можно переместить.

**Удаление узлов**

После выделения вершин для их удаления надо нажать клавишу ``Delete``, вершины будут 
удалены. 

.. note::
   Обратите внимание, что, согласно стандарту NextGIS QGIS, необходимое количество 
   узлов для каждого типа объекта все же останется. Чтобы полностью удалить объект, 
   надо использовать другой инструмент, а именно "Удалить выделенное".

**Перемещение узлов**

Выделите все вершины, которые собираетесь перемещать. Все выделенные вершины будут 
перенесены в направлении курсора. Если активна функция прилипания, все вершины могут 
перескочить на ближайшие узлы или линии.

При отпускании кнопки мыши все изменения будут сохранены и появятся в диалоге отмены. 
Запомните, что все операции поддерживают топологическое редактирование, когда оно 
включено. Перепроецирование "на лету" также поддерживается. Кроме того, инструмент 
редактирования показывает всплывающие подсказки при наведении указателя мыши на узел.

.. todo::
   Поставить гиперссылку на раздел про ввод координат с клавиатуры.

Сохранение отредактированных слоев
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Когда слой находится в режиме редактирования, любые изменения сохраняются только 
в памяти NextGIS QGIS. Изменения не сохраняются непосредственно на диск. Если необходимо 
сохранить изменения в текущем слое и при этом продолжать его редактирование, то 
нужно нажать на кнопку "Сохранить изменения". Если выключить режим 
редактирования, нажав на "Режим редактирования" (или просто 
выйти из NextGIS QGIS), то появится запрос программы, на сохранение изменений.

Если изменения не могут быть сохранены (например, диск полон или атрибуты имеют 
неверное значение), NextGIS QGIS сохранит их в своей памяти. Это позволит откорректировать 
изменения и попробовать еще раз сохранить изменения на диск.

.. tip::
   Целостность данных. Создание резервной копии данных перед началом редактирования — 
   это всегда хорошая идея. Несмотря на то, что авторы NextGIS QGIS сделали все 
   возможное для сохранения ваших данных, они по-прежнему не дают никаких гарантий 
   в этом отношении.

.. todo::
   Дополнительные функции оцифровки

Дополнительные возможности редактирования векторного слоя:

1. Отменить:

.. figure:: _static/drawing_tools_btn_undo.png
   
2. Вернуть:

.. figure:: _static/drawing_tools_btn_redo.png

Инструменты ``Отменить`` и ``Вернуть`` позволяют отменить либо вернуть 
последний или какой-либо конкретный шаг при редактировании векторных данных. При этом 
состояние всех объектов и их атрибутов возвращается на шаг назад. 

3. Повернуть объект:

.. figure:: _static/drawing_tools_btn_rotate.png

Выделите объект и нажмите кнопку поворота. Объект можно будет вращать мышью. После 
вращения его геометрия пересчитается с учётом искажения проекции. Можно вращать группу объектов.
С нажатой клавишей ``Ctrl`` можно перетащить точку центра поворота (отображается красным плюсом).

4. Упростить объект:

.. figure:: _static/drawing_tools_btn_simplify.png

Инструмент ``Упростить объект`` позволяет уменьшить количество вершин объекта, при этом, 
геометрия объекта не изменяется. Необходимо выделить объект, после чего он будет 
подсвечен красным и появится окно. При движении значений красная опоясывающая 
линия меняет свою форму, показывая тем самым, как именно объект будет упрощен. Если 
нажать кнопку "OK", новая упрощенная геометрия будет сохранена. Если объект не может 
быть упрощен (например, мультиполигоны), появится всплывающее окно предупреждения.

5. Добавить кольцо:

.. figure:: _static/drawing_tools_btn_addring.png

Можно создать кольцевой полигон (с дыркой посредине), используя функцию Добавить кольцо на панели инструментов. 
Внутри существующего полигона можно оцифровать последующий полигон, который превратиться 
в "отверстие", таким образом, только оставшаяся область между границами внешнего и
внутреннего полигона и будет кольцевым полигоном.

6. Добавить часть:

.. figure:: _static/drawing_tools_btn_addpart.png

Можно использовать "Добавить часть" для добавления новых полигонов к мультиполигональным
объектам. Новая полигональная часть должна быть создана за границами мультиполигона.

7. Заполнить кольцо

Нарисуйте полигон над уже существующим полигоном. Появится новый объект, а в существующем полигоне на его месте будет дырка.

8. Удалить кольцо:

.. figure:: _static/drawing_tools_btn_DeleteRing.png

Инструмент "Удалить кольцо" удаляет дырки внутри полигона. Им нужно нажимать на дырку.
Этот инструмент работает только с полигональными слоями. Никакик изменений 
не произойдет, если инструмент применяется на внешнем контуре полигона. Инструмент 
может применяться как для полигональных объектов, так и на мультиполигональных. 
Перед тем, как выделить вершины кольца, настройте порог прилипания для вершин.

9. Удалить часть:

.. figure:: _static/drawing_tools_btn_DeletePart.png

Инструмент "Удалить часть" позволяет удалять части мультиполигональных объектов (например, 
удалить полигон мультиполигонального объекта). Инструмент не сможет удалить последнюю
часть объекта. Она останется нетронутой. Инструмент работает со всеми типами геометрии: 
точками, линиями, полигонами. Перед тем, как выделить вершины части, необходимо 
настроить порог прилипания для вершин.

10. Корректировать форму:

.. figure:: _static/drawing_tools_btn_Reshape.png

Инструмент работает для линий и полигонов. Им рисуется ломаная линия, в конце нужно 
нажать правую кнопку мыши. Если начать линию снаружи полигона, провести её внутри полигона, 
и закончить за границей, то из полигона вырежется и удалится кусок. Если начать линию 
изнутри полигона, вывести за границу и закончить внутри полигона, то у полигона появится вырост.


.. figure:: _static/drawing_tools_btn_ReshapeDraw1.png

   Линия проведена снаружи полигона.

.. figure:: _static/drawing_tools_btn_ReshapeDraw2.png

   Из полигона вырезается кусок.

.. figure:: _static/drawing_tools_btn_ReshapeDraw3.png

   Линия проведена изнутри полигона.

.. figure:: _static/drawing_tools_btn_ReshapeDraw4.png

   К полигону добавляется вырост.
   
.. figure:: _static/drawing_tools_btn_ReshapeDraw5.png

   Инструмент корректирования формы применяется к линии.

.. figure:: _static/drawing_tools_btn_ReshapeDraw6.png

   Изменена форма линии.
   

Редактирование нескольких полигональных объектов одновременно невозможно, 
так как при этом будут создаваться полигоны с ошибочной геометрией.

.. note::
   Инструмент корректировки объектов может изменять начало кольца полигона или
   замкнутой линии. Так, точка, представленная "дважды", больше не будет таковой. Это 
   не должно быть проблемой при использовании большинства приложений, но, тем не менее, 
   это необходимо иметь в виду.

11. Параллельная кривая.

.. figure:: _static/drawing_tools_btn_OffsetCurve.png

Инструмент "Параллельная кривая" предназначен для параллельного переноса линий и колец 
полигона. Инструмент может применяться к редактируемому слою (в этом случае изменяются 
объекты) или же к фоновым слоям (в этом случае создаются копии линий/колец и добавляются 
в редактируемый слой). Таким образом, он идеально подходит для создания линейных 
слоёв с фиксированным шагом. 
Размер смещения отображается в нижней левой части строки состояния.

12. Разбить объекты.

.. figure:: _static/drawing_tools_btn_splitFeatures.png

 Инструмент "Разбить части" разрезает объект 
на фичи.  Получается два объекта с одинаковыми атрибутами.


.. figure:: _static/drawing_tools_btn_plitFeatures1.png

   Исходный объект

.. figure:: _static/drawing_tools_btn_plitFeatures2.png

   Разрезаный объект, получаются две фичи с одинаковыми атрибутами.
 
13. Разбить части.

.. figure:: _static/drawing_tools_btn_splitParts.png

   Инструмент "Разбить части" работает только для слоёв с мультигеометриями, разрезает объект 
на части. Получается один мультиполигональный объект из двух частей.


.. figure:: _static/drawing_tools_btn_splitParts1.png

   Исходный объект

.. figure:: _static/drawing_tools_btn_splitParts2.png

   Разрезаный объект, в таблице атрибутов видно, что объект остаётся один.
 

14. Объединить выбраные объекты.

.. figure:: _static/drawing_tools_btn_mergeFeatures.png

Этот инструмент позволяет объединять объекты, которые имеют общие границы и атрибуты.

15. Объединить атрибуты выбранных объектов.

Этот инструмент позволяет объединять атрибуты нескольких объектов без их объединения 
в один объект.



   


Задание Оцифровать здания и пешеходные дороги по аэрофотоснимку
------------------------------------------------------------------------

Учебные данные: снимок с квадрокоптера brateevo-park.tiff В нём есть и здания, и дороги, и луговые, и степные участки.

1. Начинаем рисовать дороги. Выбираем, какой тип геометрии для этого подойдёт - линия.
2. Создаём временный слой.
3. Придумываем, какие атрибуты нам нужны. Я не придумал, поэтому можно не вводить.
4. Рисуем дороги.
5. Включаем прилипание, и делаем так что бы дороги соприкасались.
6. Сохраняем как brateevo-roads.gpkg
7. Рисуем так же здания. В этой местности есть здания с внутренним двором.

Создаём слой с атрибутами.
-----------------------------

Рисуем полигоны
-----------------------------

Задание: Рисуем милицию с внутренним двором (дырки)
-------------------------------------------------------

Задание: Рисуем мультиобъекты - собачьи площадки
--------------------------------------------------------------

Задание: осознаём мультиточки на примере муниципального реестра
---------------------------------------------------------------------

Учебные данные: 1. Снимок парк Братеевская Пойма. 2. Таблица с фейковым реестром объектов благоустройства: "Урны у входа", "Столбики у вьезда".

id;name;cost;location
201;Урны у входа в парк Братеевская Пойма;54654;Ул. Братеевская, вход в парк
202;Фонарные столбы;13567;Ул. Братеевская, 18, детская площадка


1. Импортировать слой как таблицу без геометрии
2. Создать временный слой. Мультиточки, атрибуты как у таблицы.
3. Добавить мультиточками объекты 


Топология
==========


Топология описывает простарнственные отношения между соединенными или прилегающими векторными объектами (точками, линия и полигонами) в ГИС. Топологические данные весьма полезны при поиске и исправлении ошибок оцифровки (например, две линии в слое дорог не соединены в точке пересечения). Топология необходима при проведении некоторых видов анализа, например, анализа сети.

Представьте, что вы приехали в Лондон. Вы хотите посетить собор Св. Павла, а во второй половине дня поехать на Ковент-Гарден и купить сувениры. Поэтому вам необходимо на карте метро Лондона (см.рисунок figure_topology_london) найти поезда, соединяющие собор Св. Павла и Ковент-Гарден. Для решение этой задачи нужна топологическая информация (данные) о том, где можно выполнить пересадку. На карте метро топологические взаимоотношения ообзначены окружностями.

Figure London Underground Network 1:
https://docs.qgis.org/2.14/en/_images/london_underground.png

Ошибки топологии
-----------------

Помимо ошибок в указании месторасположений, бывают ошибки в тополоических отношениях объектов. Существуют объекты, для которых в этом наборе данных некоторые типы отношений недопустимы. Например мы рисуем границы избирательных участков, и они не должны пересекать здания, или же на карте высот не должны пересекаться горизонтали.

Существует разные ошибки топологии, но все они делятся на группы в зависимости от того наблюдаются они на линиях или на полигонах. Топологические ошибки полигональных объектов включают незамкнутые полигоны, щели между смежными границами полигонов или наложение полигонов. Наиболее частая ошибка топологии линейных объектов — отсутствие правильного пересечения в узле. Такие ошибки называют недоводом, если между линиями имеется щель, и перехлест, если концы линий выходят за пределы узла вместо соединения в нем (см. рисунок figure_topology_errors).

Figure Topology Errors 1:
https://docs.qgis.org/2.14/en/_images/topology_errors.png

Недовод (1) возникает когда линии, которые должны быть соединены друг с другом, не соприкасаются. Перехлесты (2) возникают, если линия пересекает другую линию, с которой она должны быть соединена. Щели (3) возникают когда вершины соседних полигонов имеют различия в координатах.

В результате недоводов и перехлестов на концах линий образуются так называемые «зависшие узлы». В некоторых случаях наличие зависших узлов допустимо, например, если они обозначают тупик.

Топологические ошибки нарушают взаимоотношения между объектами. Эти ошибки должны быть исправлены, чтобы можно векторные данные можно было использовать в анализе, таком как сетевой анализ (например, найти наилучший маршрут) или для измерений (например, вычислить длину реки). Помимо импользования данных в анализе существуют и другие причины, по которым стоит создавать или иметь данные с корректной топологией. Представьте, что вы выполняете оцифровеку границ районов или областей и полигоны перекрываются или между ними есть щели. В таком случае вы сможете использовать инструменты измерений, но полученный результат будет неправильным. Вы не будете знать правильную площать каждого муниципального образования и не сможете точно определить границу между ними.

Наличие топологически корректных данных важно не только для вас самих, но и для других людей, которые пользуются вашими данными. Ведь они ожидают, что ваши данные и результаты ваших анализов правильны!

Топологические правила
------------------------

К счастью, большинства распространенных ошибок при оцифровке можно избежать при помощи топологических правил, реализованых во многих ГИС.

За исключением некоторых специальных форматов ГИС-данных, по умолчанию проверка топологии не проводится. Многие ГИС, например QGIS, определяют топологию как набор определенных правил и позволяют пользователям выбрать те из них, которые будут применяться к слою.

Ниже приведены примеры того, как могут определяться правила топологии применительно к объектам реального мира на карте:

    Полигоны на карте муниципальных районов не должны накладываться друг на друга.

    Полигоны на карте муниципальных районов не должны иметь разрывов (щелей).

    Полигоны, обозначающие границы, должны быть замкнуты. Недоводы или перехлесты линий, образующих границы, запрещены.

    Горизонтали в линейном слое не должны пересекаться.



Топологическое редактирование
--------------------------------

Многие ГИС-приложения предоставляют инструменты для топологического редактирования. Так, в QGIS можно использовать активировать режим «Топологическое редактирование» чтобы сделать редактирование общих границ полигонов более удобным. Такие ГИС как QGIS «обнаруживает» общую границу полигонов, и при изменении вершины одного из полигонов автоматически обновляет границы остальных как показано на рисунке figure_topological_tools (1).

Ещё одной возможностью является предотвращение пересечений полигонов в процессе офифровки (см. рисунок figure_topological_tools (2)). Если один полигон уже создан, можно нарисовать смежный полигон с «нахлестом» и QGIS автоматически произведет обрезку второго полигона по общей границе.

Figure Topological Tools 1:
https://docs.qgis.org/2.14/en/_images/topological_tools.png

(1) Topological editing to detect shared boundaries, when moving vertices. When moving a vertex, all features that share that vertex are updated. (2) To avoid polygon overlaps, when a new polygon is digitised (shown in red) it is clipped to avoid overlapping neighbouring areas.





Включение топологического редактирования
--------------------------------------------

Включение прилипания
---------------------------------------------

Расстояние прилипания это расстояние, используемое ГИС для поиска ближайшего узла и/или вершины, к которому можно присоединиться в процессе оцифровки. «Сегмент» — это участок полигона или линии между двумя соседними узлами. Если вы не превысили расстояние прилипания, такая ГИС как QGIS оставит новый узел именно в том месте, где была нажата кнопка мыши, а не присоединит его к существующему узлу или сегменту (см. figure_snapping_distance).

Figure Snapping Distance 1:
https://docs.qgis.org/2.14/en/_images/snapping_distance.png

The snapping distance (black circle) is defined in map units (e.g. decimal degrees) for snapping to either vertices or segments.



Расстояние прилипания
---------------------------

Snapping distance and search radius are both set in map units so you may need to experiment to get the distance value set right. If you specify a value that is too big, the GIS may snap to a wrong vertex, especially if you are dealing with a large number of vertices close together. If you specify the search radius too small the GIS application won’t find any feature or vertex to move or edit.


Задание: рисуем переписные участки
-----------------------------------

Вводная:  это пример задачи из реальной жизни, данные упрощены и изменены.

Учебные данные: точечный слой из точек на домах в городском районе. У точки есть номер участка

http://trolleway.nextgis.com/resource/2941


1. Настраиваем у слоя стиль из случайных цветов
2. Подкладываем подложку OSM
3. Создаём новый полигональный слой.
4. Включаем топологическое редактирование, обрисовываем слой. Нужно 5 объектов.
5. Проверяем геометрию полигонального слоя.
6. Разбираемся с ошибками, если они будут.

Иногда можно починить невалидные полигоны буфером с размером 0. Так же можно перерисовать с инструментом коррекции геометрии и сдвигания узлов. Но это работает не всегда, часто остаётся только удалить фичу и нарисовать заново.

Плагин проверки геометрии выводит полигоны с невалидной топологией - как настроишь. Это варианты:

* Слой должен иметь валидную геометрию.
* Слой не должен иметь дубликатов.
* Слой не должен иметь щелей между фичами.
* Слой не должен иметь мультиобъектов
* Слой не должен иметь накладывающихся фич.
* Слой не должен иметь накладывающихся фич на другой слой.
* Слой не должен иметь висящих в воздухе концов линии, не попадающих на точечный слой.
* Слой не должен иметь dangles
* Слой не должен иметь pseudos
* Слой точечного типа не должен иметь висящих в воздухе точек
* Слой точечного типа не должен иметь точек не покрываемых концами линий

Подведём итоги:

    Топология описывает пространственные взаимотношения соседних векторных объектов.

    Топология в ГИС обеспечивается интсрументами топологии.

    Топология может использоваться для поиска и исправления ошибок оцифровки.

    Топологические данные очень важны для неокторых инструментов, например сетевого анализа.

    Рассстояние прилипания и радиус поиска помогают создавать топологически корректные векторные данные.

    Данные вида Simple feature не являются настоящим топологически корректным форматом данных, но широко применяются в ГИС-приложениях.



Дополнительные инструменты оцифровки.
--------------------------------------------

Выборки объектов
=============================

Фильтр для слоя.
=============================

Оператор =
^^^^^^^^^^^^^^^^^^^^

ВЗЯТЬ ИЗ ИНСТРУКЦИИ

Оператор IN
^^^^^^^^^^^^^^^^^^^^

ВЗЯТЬ ИЗ ИНСТРУКЦИИ

Оператор wildcard 
^^^^^^^^^^^^^^^^^^^^

ВЗЯТЬ ИЗ ИНСТРУКЦИИ

Фильтрование идёт быстро, на уровне провайдера, если он это поддерживает. При сохранении слоя, остаются эти же фичи.

    Фильтры внизу таблицы. Они медленнее
    Показывать только видимые
    Фильтры, которые в таблице атрибутов

Операции с проекциями.
================================


Проекции
-----------------------------

В :program:`NextGIS QGIS` реализована возможность работы с проекциями. Проекция 
может быть установлена как глобально, т.е. её параметры будут применены к любому 
векторному слою, не содержащему информации о проекции, так и отдельно для проекта. 
Кроме того, существует возможность создания собственных проекций, а также реализована 
поддержка перепроецирования "на лету" для векторных и растровых слоёв. Все эти функции 
позволяют корректно отображать одновременно несколько слоёв, находящихся в различных 
проекциях.

Все проекции в :program:`NextGIS QGIS` основаны на базе идентификаторов European Petroleum Group (:term:`ESPG`) и Institut Geographique National of France (IGNF). EPSG-коды хранятся в базе данных 
и могут быть использованы для определения проекции.

Для корректной работы перепроецирования "на лету" слой должен содержать информацию о 
проекции, в которой хранятся данные, либо она должна быть определена самостоятельно 
на уровне слоя или проекта. Для слоёв PostGIS :program:`NextGIS QGIS` использует 
идентификатор проекции, определяемый в момент создания слоя. Для данных, хранящихся 
в форматах, поддерживаемых GDAL, информация о проекции должна быть представлена в 
соответствующем файле, структура которого определяется форматом. В случае ESRI Shapefile - 
это файл, содержащий описание проекции в формате :abbr:`WKT (Well Known Text)` и имеющий 
то же имя, что и ESRI Shapefile, но с расширением .prj. Например, для файла ``alaska.shp`` 
файлом описания проекции будет ``alaska.prj``.

Всякий раз, когда происходит выбор новой проекции, используемые единицы слоя автоматически
изменяются.

Почти всегда в NextGIS QGIS используется функция "преобразования 
координат на лету": слои хранятся в разных системах координат, а в составе карты они выводятся в одной. 

Систем координат очень много, однако для работы одновременно используется всего несколько. Наиболее популярные следующие системы координат:  

* WGS 84 (EPSG:4326) - в ней обычно хранятся векторные данные. Единица измерения
  - градусы. Новые векторные файлы сохраняйте в ней. Если отобразить геоданные в этой системе координат  
  без перепроецирования, то картинка будет сплющенной.
  
.. figure:: _static/projections_4326.png
   :name: projections_4326
   :align: center
   :width: 8cm

   Данные выведены на экран в EPSG:4326. 
   
* Pseudo Mercator (EPSG:3857) - используется для отображения. Включайте "перепроецирование
  на лету" в 3857, и карта будет отображаться более правильно.
    
.. figure:: _static/projections_3857.png
   :name: projections_3857
   :align: center
   :width: 8cm

   Данные выведены на экран в EPSG:3857. 
   
* WGS 84 / UTM Zone X (EPSG:32610..32709) - используется для измерения расстояний. 
  Данные хранятся в метрах. Некоторые инструменты требуют её для корректной работы. 
  Так же в ней могут храниться космоснимки. Земной шар разделён на 60 зон, для 
  каждой определена своя проекция - свой код EPSG. 
      
.. figure:: _static/projections_32637.png
   :name: projections_32637
   :align: center
   :width: 8cm

   Данные выведены на экран в EPSG:32637. Все зоны кроме 37-й искажены. 
  
* Pulkovo 1942 / Gauss-Kruger zone X (EPSG:28401..28432 и соседние) - устроена 
  так же как UTM, в ней хранятся привязанные листы советских топокарт (изданных 
  в последние годы). Так же разделена на зоны. 
  
* Asia_North_Equidistant_Conic (EPSG:102026) - для вывода на экран карты России  
* North_Pole_Azimuthal_Equidistant (EPSG:102016) - для вывода на экран карты северного полюса    

Основные операции с проекциями:
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

1. **Как узнать систему координат слоя**
 
``Слой ‣ Свойства ‣ Вкладка Общие ‣ Система координат``. 
Это значение можно менять. Систему координат сохранёную в слое можно узнать  
``Слой ‣ Свойства ‣ Вкладка Метаданные ‣ строка Система координат слоя``.

2. **Открытие окна преобразования координат**

В правом-нижнем углу карты нажмите вторую справа кнопку. Если на ней написано ``OTF``, 
значит преобразование на лету включёно.

3. **Если картинка на карте сплющена по вертикали**

Если вы добавили геоданные на карту, и картинка сплющенная, то включите "Преобразование 
коодинат на лету" в EPSG:3857. Это значит, что ваши геоданные были в градусах.

4. **Если данные из разных слоёв не попадают друг на друга, хотя они должны быть в одном месте**

Включите "Преобразование коодинат на лету".

5. **Пересохранение слоёв в другую систему координат**

Для некоторых операций требуется пересохранить слои в другую систему 
координат. В этом случае выберите ``Слой ‣ Сохранить как``, и выберите 
систему координат в диалоге сохранения. 

6. **Как узнать номер зоны UTM или Gauss-Kruger**

В окне поиска QMS ввести запрос "utm". В результатах будет слой "UTM and Gauss Krueger 6 degree zones" - это разграфка на весь мир в формате GeoJSON.
Что делать если кракозябры

Идентификация.
================================

    Окна остаются на фоне, поэтому красные выделения остаются.
    Смотрим данные клиента.
    
Правка данных в таблице.
================================

    Добавление-удаление полей работает в шейпе.
    Копируем объекты в временный слой
    Добавляем атрибуты и правим их.

Калькулятор полей.
================================

Полезные операторы

Задание: генерируем поле состоящее из конкатенации
------------------------------------------------------


Связь слоёв по атрибутам
================================

Связь точек замеров и данных замеров из Excel.

Расчёт расстояний и площадей
================================

    Проверяем настройку использования эллипсоида (кнопка та где перепроецирование менять)
    Считаем линейкой.
    Считаем в окне идентификации
    Добавляем геометрию модулем.
    Считаем через dissolve


Оформление векторных слоёв
================================

    Берём слой городов из осм
    Смотрим точечные объекты
    Берём слой воды
    Смотрим заливки
    Берём слой "водные объекты"
    Уникальные значения
    Берём слой дорог из OSM
    Правила
    
Уровни знака
---------------------
    
    берём слой "общественное питание в Москве"
    
градуированый
-----------------

кластеры
-----------------

теплокарта
----------------
        
Сохранение стилей в файл
---------------------------

Копирование-вставка стилей
----------------------------

Выбор стилей из списка
----------------------------


Подписи
================================

Генерация подписей на лету
-------------------------------------------

Можно подписывать не только текстом из поля, но и выражением.
знак '\n' делает перенос строки
функция wordwrap() делает перенос строки

Задача: генерация подписей с переносом
----------------------------------------------

Задача: подпись площади в гектарах
-----------------------------------------------

Ручное перемещение и поворот подписей
-------------------------------------------

Создание форм ввода в QGIS
======================================

Они хранятся в стилях. Можно выбирать пикеры


Векторные операции    
================================    

Обзор меню векторных операций
-------------------------------

Проходим по всем модулям
-------------------------------

Задача: расчёт статистики по распределению точек в областях
-------------------------------------------------------------------

Вводная:
Гражданские активисты выдвинули гипотезу, что в Москве плохо обслуживают трамвайный путь. Они взяли NextGIS Simple Collector, созвали 6 человек, и получили слой с координатами разбитых стыков. Далее они хотят подсчитать статистику, что бы результат соответствовал формату их предыдущего сбора на бумажке. 

Учебные данные: 
1. Точечный слой из NextGIS Simple Collector - обследование трамвайных путей
2. Линейный слой - участки трамвайных линий.

Выполнение:

1. Рисуем вокруг участков линий полигоны, включив прилипание и топологическое редактирование.
2. Перепроецируем точечный слой из 3857 в 4326
3. Делаем объединение атрибутов по районам с расчётом суммы
4. Получаем таблицу - на каком участке сети сколько каких дефектов.


Задача: генерация сетки 
-------------------------------------------------------------

Вводная: 
Для визуализации можно объединить эти точки с условной сеткой, получится другая картина. Благодаря ей, можно найти концентрацию, если она не совпадает с нарисованой вручную структурой.

1. Берём точки из предыдущего шага.
2. Генерируем сетку в 4326 - получается сплющенной.
3. Генерируем сетку в 32637, она получается квадратной, но повёрнутой.

Так же есть статья http://docs.nextgis.ru/docs_howto/source/grid_vertex_extract.html


Модуль Geoprocessing
---------------------

Модели
---------------------


Использование данных из навигаторов Garmin. Получение и отправка данных.
============================================================================

собственно тут всё говорится одной фразой, так исторически сложилось что это было на главном уровне, надо переместить к разделу OSM

Создание компоновки
================================

Создание диаграм
================================

Использование векторных данных Openstreetmap
================================================

wiki.osm.org
---------------------

QUICK OSM
---------------------

overpass-api
---------------------

gis-lab выгрузки
---------------------

openstreetmapdata
---------------------

OSM Info
---------------------

Выкачать чего-нибудь и неможко оформить

Тайлы в QMS
---------------------

тайлы в qms, будет мутность если выбрал не тот масштаб, можно включиить мультипоточный реднеринг







Map Composer
============================

